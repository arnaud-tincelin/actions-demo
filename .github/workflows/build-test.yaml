name: Build & Tests

on: push

env:
  GO_VERSION: '1.17'

jobs:
  runs-on: ubuntu-latest
  build-test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - name: Set up Go
          uses: actions/setup-go@v2
          with:
            go-version: ${{ env.GO_VERSION }}
        - name: Download modules
          run: go mod download
        - name: Build project
          run: go build ./cmd/demo
        - name: Go tests
          run: go test -v -race -coverprofile=coverage.out -covermode=atomic ./...
        - name: Upload coverage to Codecov
          run: bash <(curl -s https://codecov.io/bash) -C $(Build.SourceVersion)
